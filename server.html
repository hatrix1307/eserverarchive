<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Eagler Server List</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
<meta http-equiv="x-ua-compatible" content="ie=edge"/>
<meta name="twitter:card" content="summary"/>
<meta property="theme-color" content="#FB8464"/>
<link rel="icon" type="image/png" href="/eagler.png">
<link rel="shortcut icon" type="image/png" href="/eagler.png">

<!-- All Original CSS -->
<link rel="stylesheet" href="/_next/static/css/7b2b4dd7ecbe86d1.css">
<link rel="stylesheet" href="/_next/static/css/76289acd00d625c1.css">
<link rel="stylesheet" href="/_next/static/css/4d58c923eeda897e.css">
<link rel="stylesheet" href="/_next/static/css/dc7d422723254cb5.css">
<link rel="stylesheet" href="/_next/static/css/801a346d713e02de.css">
<link rel="stylesheet" href="/_next/static/css/2be4c86ae301c45c.css">
</head>

<body>
<div id="__next">
  <main class="__className_cc80f9">

    <!-- NAVBAR -->
    <nav class="Navbar_root__hs6un">
      <div class="Navbar_logo__eioWt">
        <a href="/"><img src="/eagler.png" alt="Logo"></a>
        <h1>Eagler Server List</h1>
      </div>
      <div class="Navbar_spacer__t53No"></div>
      <ul class="Navbar_navElements__a5nON">
        <li><a href="/">Home</a></li>
        <li><a href="/news">Site News</a></li>
      </ul>
    </nav>

    <!-- PAGE -->
    <div class="Server_root__SeWV0">
      <div class="Server_flexCenter__mnne6" id="header"></div>
      <div class="Server_cardsRow__ulRw7" id="info"></div>
      <div class="Server_cardsRow__ulRw7" id="description"></div>
    </div>

    <!-- FOOTER -->
    <footer class="Footer_footer__yUjxG">
      <p>Copyright Â© Eagler Server List 2025</p>
      <br>
      <ul>
        <li><a href="/privacy"><b>Privacy Policy</b></a></li>
        <li><a href="/tos"><b>Terms of Service</b></a></li>
        <li><a href="https://discord.gg/jT7YZxDarC"><b>Discord Server</b></a></li>
      </ul>
    </footer>

  </main>
</div>

<script>
(async () => {
  const id = new URLSearchParams(location.search).get("id");
  if (!id) return;

  const res = await fetch(`/data/${id}.json`);
  if (!res.ok) {
    document.getElementById("header").innerHTML = "<h1>Server not found</h1>";
    return;
  }

  const json = await res.json();
  const s = json.data || json;

  document.title = `Eagler Server List | ${s.name}`;

  // HEADER
  document.getElementById("header").innerHTML = `
    <h1 style="margin-top:10px;">${s.name}</h1>
    <div class="Server_ownerAvatar__k3zpv" style="text-align:center;">
      <img src="${s.user?.avatar || ""}" alt="Owner Avatar" style="width:50px;height:50px;border-radius:50%;margin-right:10px;">
      <span style="color:orange;font-weight:bold;">${s.user?.username || "Unknown"}</span>
    </div>
    <h3 style="color: gray;text-align:center;">Created at: ${new Date(s.createdAt).toLocaleString('en-GB', { day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit' })}</h3>
    <div style="text-align:center;margin-top:5px;">
      ${s.tags.map(tag => `<span style="display:inline-block;background:black;color:${tag==='PVP'||tag==='PVE'?'red':'#4caf50'};padding:2px 8px;margin:2px;border-radius:12px;font-size:0.9em;">${tag}</span>`).join('')}
    </div>
  `;

  // INFO CARDS
  document.getElementById("info").innerHTML = `
    <div class="Card_card__dlNs0" style="margin-right:10px;display:inline-block;width:48%;vertical-align:top;">
      <div class="Card_header__ZfKiq"><p>Server Info</p></div>
      <div class="Card_content__D0RDr" style="display:flex;justify-content:space-between;">
        <div>
          <h3 style="color:white;font-size:1.1em;">Address</h3>
          <p id="server-address" style="color:#FF8A65;font-weight:bold;cursor:pointer;">${s.address || "N/A"}</p>
        </div>
        <div>
          <h3 style="color:white;font-size:1.1em;">Discord Server</h3>
          <p><a href="https://discord.gg/${s.discord}" target="_blank" style="color:#FF8A65;">Join Discord</a></p>
        </div>
      </div>
    </div>
    <div class="Card_card__dlNs0" style="display:inline-block;width:48%;vertical-align:top;">
      <div class="Card_header__ZfKiq"><p>Votes</p></div>
      <div class="Card_content__D0RDr">
        <h3 style="color:#4caf50;font-weight:bold;font-size:1.2em;">${s.votes || 0}</h3>
      </div>
    </div>
  `;

  // DESCRIPTION CARD
  document.getElementById("description").innerHTML = `
    <div class="Card_card__dlNs0" style="margin-top:15px;">
      <div class="Card_header__ZfKiq"><p>Description</p></div>
      <div class="Card_content__D0RDr">
        ${s.description || "<p>No description available.</p>"}
        <p id="server-status" style="margin-top:10px;font-weight:bold;">Loading server status...</p>
      </div>
    </div>
  `;

  // Copy address click
  const addrEl = document.getElementById("server-address");
  addrEl.addEventListener("click", () => {
    navigator.clipboard.writeText(addrEl.textContent);
    let copied = document.createElement("span");
    copied.textContent = "Copied!";
    copied.style.color = "#FF8A65";
    copied.style.marginLeft = "10px";
    addrEl.parentNode.appendChild(copied);
    setTimeout(() => copied.remove(), 2000);
  });

  // Fetch server status
  async function updateStatus() {
    try {
      const apiAddr = s.address.replace(/^wss:\/\//, "");
      const statusRes = await fetch(`/api/status/${encodeURIComponent(apiAddr)}`);
      const statusJson = await statusRes.json();
      if (statusJson.success && statusJson.server) {
        const server = statusJson.server;
        const statusText = server.online
          ? `Online - Players: ${server.players.online}/${server.players.max}`
          : "Offline";
        document.getElementById("server-status").textContent = statusText;
      } else {
        document.getElementById("server-status").textContent = "Status unavailable";
      }
    } catch(e) {
      document.getElementById("server-status").textContent = "Status error";
    }
  }

  updateStatus();
  setInterval(updateStatus, 30000); // refresh every 30 seconds

})();
</script>

</body>
</html>
