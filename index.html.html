<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Eagler Server List | Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
<meta http-equiv="x-ua-compatible" content="ie=edge"/>
<meta name="twitter:card" content="summary"/>
<meta property="theme-color" content="#FB8464"/>
<meta property="og:url" content="index.html"/>
<meta property="og:title" content="Eagler Server List | Home"/>
<meta property="og:site_name" content="Eagler Server List"/>
<meta property="og:type" content="website"/>
<meta property="og:description" content="Check out all of the servers on the site. Why not sign up and add your own?"/>
<meta property="og:image" content="eagler.png"/>
<link rel="icon" href="favicon.ico"/>

<!-- Exact mirrored CSS -->
<link rel="stylesheet" href="_next/static/css/7b2b4dd7ecbe86d1.css"/>
<link rel="stylesheet" href="_next/static/css/76289acd00d625c1.css"/>
<link rel="stylesheet" href="_next/static/css/dc7d422723254cb5.css"/>
<link rel="stylesheet" href="_next/static/css/801a346d713e02de.css"/>
<link rel="stylesheet" href="_next/static/css/2be4c86ae301c45c.css"/>

<style>
/* Ensure dynamic server container works correctly */
#dynamic-server-container {
    min-height: 50vh;
}
.loading-text {
    color: #fff;
    text-align: center;
    padding: 20px;
    font-size: 1.2rem;
}
button:not([disabled]) svg {
    color: #fb8464 !important;
}
button[disabled] svg {
    color: rgb(170, 170, 170) !important;
}
.player-count {
    font-weight: bold;
    color: rgb(70, 227, 147);
}
.status-dot {
    transition: background-color 0.4s ease;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
}
</style>
</head>
<body style="background-color: #111; color: #fff;">
<div id="__next">
    <div>
        <main class="__className_cc80f9">
            <main class="Home_appContainer__0oIwU" style="opacity:1;">
                <div>
                    <nav class="Navbar_root__hs6un">
                        <div class="Navbar_logo__eioWt">
                            <img src="eagler.png" alt="Logo">
                            <h1>Eagler Server List</h1>
                        </div>
                        <div class="Navbar_spacer__t53No"></div>
                        <ul class="Navbar_navElements__a5nON">
                            <li class="Navbar_active__OcRhr"><a href="#">Home</a></li>
                        </ul>
                    </nav>
                    <div class="Home_homeRoot__D6YiM">
                        <h1>Servers</h1>
                        <div id="dynamic-server-container">
                            <p class="loading-text">Loading server data...</p>
                        </div>
                        <div class="Home_pages__jwp2L" style="margin-top: 20px;">
                            <button id="btn-prev" class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary Mui-disabled css-yfi1n3" type="button" disabled>
                                <span class="MuiButton-icon MuiButton-startIcon">
                                    <svg viewBox="0 0 24 24" height="1em" width="1em">
                                        <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                                    </svg>
                                </span>
                                Previous Page
                            </button>
                            <button id="btn-next" class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-yfi1n3" type="button">
                                Next Page
                                <span class="MuiButton-icon MuiButton-endIcon">
                                    <svg viewBox="0 0 24 24" height="1em" width="1em">
                                        <path d="M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                                    </svg>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </main>
    </div>
</div>

<script>
let allPages = [];
let currentPage = 0;

function getDisplayAddress(addr) {
    if (!addr) return "";
    return addr.startsWith("wss://") ? addr : "wss://" + addr;
}

function getApiAddress(addr) {
    return addr.replace("wss://", "");
}

async function init() {
    try {
        const response = await fetch('./serverlistjson.txt');
        const rawText = await response.text();
        const pageStrings = rawText.split(/}\s*{/).map((str,i,arr)=>{
            if(i===0) return str+"}";
            if(i===arr.length-1) return "{"+str;
            return "{"+str+"}";
        });
        pageStrings.forEach(jsonStr=>{
            try{
                const parsed = JSON.parse(jsonStr);
                if(parsed.success && Array.isArray(parsed.data)) allPages.push(parsed.data);
            }catch(e){}
        });
        if(allPages.length>0) renderPage(0);

        document.getElementById('btn-prev').addEventListener('click',()=>changePage(-1));
        document.getElementById('btn-next').addEventListener('click',()=>changePage(1));

        setInterval(refreshCurrentPageStatus, 20000);
    } catch(err){
        console.error("Failed to load server list:", err);
    }
}

function changePage(direction){
    const newPage = currentPage + direction;
    if(newPage>=0 && newPage<allPages.length){
        currentPage=newPage;
        renderPage(currentPage);
        window.scrollTo(0,0);
    }
}

function renderPage(pageIndex){
    const container = document.getElementById('dynamic-server-container');
    container.innerHTML='';
    const servers = allPages[pageIndex];
    servers.forEach(server=>{
        const displayIP=getDisplayAddress(server.address);
        const apiIP=getApiAddress(server.address);
        const card=document.createElement('div');
        card.className="Server_box__TMsXv";
        card.setAttribute('data-api-address', apiIP);

        card.innerHTML=`
            <h2 style="display: flex; justify-content: space-between; align-items: center;">
                ${server.name}
                <div class="status-dot" style="background-color: #444; width: 14px; height: 14px; border-radius: 50%; border: 2px solid #222;"></div>
            </h2>
            <h3 style="color: rgb(170, 170, 170); margin: 5px 0;">
                Votes: <span style="color: rgb(70, 227, 147);">${server.votes}</span>
            </h3>
            <div class="Server_tagListContainer__tAO2z" style="display: flex; gap: 5px; flex-wrap: wrap; margin: 10px 0;">
                ${server.tags.map(tag=>`<div class="Badge_inlineBadge__h8Mo1" style="color: #fb8464; border: 1px solid #fb8464; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">${tag}</div>`).join('')}
            </div>
            <h3>IP: <span style="color: #fb8464; font-family: monospace;">${displayIP}</span></h3>
            <div class="status-meta" style="font-size: 0.85em; color: #aaa; margin-top: 10px; border-top: 1px solid #333; padding-top: 8px;">
                Pinging status...
            </div>
        `;
        container.appendChild(card);
    });
    updateButtons();
    refreshCurrentPageStatus();
}

async function refreshCurrentPageStatus(){
    const serverCards=document.querySelectorAll('.Server_box__TMsXv');
    serverCards.forEach(async card=>{
        const apiAddr=card.getAttribute('data-api-address');
        const dot=card.querySelector('.status-dot');
        const meta=card.querySelector('.status-meta');
        try{
            const res=await fetch(`https://topeaglerservers.com/api/status/${encodeURIComponent(apiAddr)}`);
            const data=await res.json();
            if(data.success && data.server && data.server.online===true){
                dot.style.backgroundColor='#4caf50';
                const online=data.server.players.online;
                const max=data.server.players.max;
                meta.innerHTML=`Players: <span class="player-count">${online}</span> / ${max}`;
            }else{
                dot.style.backgroundColor='#f44336';
                meta.innerHTML=`<span style="color: #f44336;">Offline</span>`;
            }
        }catch(err){
            dot.style.backgroundColor='#444';
            meta.innerHTML=`<span style="color: #666;">Status Error</span>`;
        }
    });
}

function updateButtons(){
    const prevBtn=document.getElementById('btn-prev');
    const nextBtn=document.getElementById('btn-next');
    prevBtn.disabled=(currentPage===0);
    currentPage===0 ? prevBtn.classList.add('Mui-disabled') : prevBtn.classList.remove('Mui-disabled');
    nextBtn.disabled=(currentPage===allPages.length-1);
    currentPage===allPages.length-1 ? nextBtn.classList.add('Mui-disabled') : nextBtn.classList.remove('Mui-disabled');
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
