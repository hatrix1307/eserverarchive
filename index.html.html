<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Eagler Server List | Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <link rel="icon" href="favicon.ico"/>

  <!-- Original styles from mirrored site -->
  <link rel="stylesheet" href="_next/static/css/7b2b4dd7ecbe86d1.css"/>
  <link rel="stylesheet" href="_next/static/css/76289acd00d625c1.css"/>

  <style>
    body { background:#0e0e10; color:#fff; }
    main { max-width:1200px; margin:auto; padding:20px; }
    #server-grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
      gap:16px;
    }
  </style>
</head>

<body>
<div id="__next">
  <main>
    <div id="server-grid"></div>
  </main>
</div>

<script>
const LOCAL_JSON = "serverlistjson.txt";
const API_BASE = "https://topeaglerservers.com/api/status/";

function cleanAddress(addr) {
  return addr.replace(/^wss:\/\//, "").replace(/^ws:\/\//, "");
}

async function loadLocalServers() {
  const res = await fetch(LOCAL_JSON);
  const json = await res.json();
  return json.data || [];
}

async function fetchLiveStatus(address) {
  try {
    const res = await fetch(API_BASE + address);
    const json = await res.json();
    return json.success ? json.server : null;
  } catch {
    return null;
  }
}

function renderServer(server, live) {
  const online = live?.online ?? server.online;
  const playersOnline = live?.players?.online ?? server.motd?.online ?? "?";
  const playersMax = live?.players?.max ?? "?";
  const pingQuality = live?.ping?.quality ?? "unknown";

  const card = document.createElement("div");
  card.className = "Server_box__TMsXv";

  card.innerHTML = `
    <h2 style="display:flex;justify-content:space-between;align-items:center;">
      ${server.name}
      <span style="
        width:12px;height:12px;border-radius:50%;
        background:${online ? '#46E393' : '#f44336'};
      "></span>
    </h2>

    <div style="color:#aaa;margin:6px 0;">
      Votes: <b style="color:#46E393">${server.votes ?? 0}</b>
    </div>

    <div class="Server_tagListContainer__tAO2z"
         style="display:flex;gap:6px;flex-wrap:wrap;margin:10px 0;">
      ${(server.tags || []).map(t =>
        `<div class="Badge_inlineBadge__h8Mo1">${t}</div>`
      ).join("")}
    </div>

    <div style="font-family:monospace;color:#fb8464;">
      ${server.address}
    </div>

    <div style="margin-top:8px;font-size:0.9em;color:#aaa;">
      Players: <b style="color:#46E393">${playersOnline}</b> / ${playersMax}
    </div>

    <div style="margin-top:4px;font-size:0.8em;color:#888;">
      Ping: ${pingQuality}
    </div>
  `;
  return card;
}

(async function init() {
  const grid = document.getElementById("server-grid");
  grid.innerHTML = "";

  const servers = await loadLocalServers();

  for (const server of servers) {
    const addr = cleanAddress(server.address);
    const live = await fetchLiveStatus(addr);
    grid.appendChild(renderServer(server, live));
  }
})();
</script>

</body>
</html>
