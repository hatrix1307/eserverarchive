<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Eagler Server List | Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="icon" href="favicon.ico">

<!-- Local Font Files -->
<link rel="preload" href="./Eagler Server List _ Home_files/eafabf029ad39a43-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="./Eagler Server List _ Home_files/8888a3826f4a3af4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="./Eagler Server List _ Home_files/0484562807a97172-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<style>
/* ---- Base Reset & Layout ---- */
body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background-color: #111;
  color: #fff;
}
main {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}

/* ---- Navbar ---- */
header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}
header img {
  height: 40px;
}

/* ---- Server List Styles ---- */
#dynamic-server-container {
  display: flex;
  flex-direction: column;
  gap: 16px;
  min-height: 50vh;
}
.Server_card {
  background: #1b1b1f;
  padding: 16px;
  border-radius: 8px;
  border: 1px solid #333;
}
.Server_card h2 {
  margin: 0 0 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.status-dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid #222;
  transition: background-color 0.4s ease;
}
.player-count {
  font-weight: bold;
  color: #46e393;
}
button {
  padding: 8px 16px;
  border: none;
  background: #27272b;
  color: #fff;
  cursor: pointer;
}
button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}
</style>
</head>

<body>
<header>
  <img src="./Eagler Server List _ Home_files/eagler.png" alt="Logo">
  <h1>Eagler Server List</h1>
</header>

<main>
  <h2>Servers</h2>
  <div id="dynamic-server-container">
    <p class="loading-text">Loading server data...</p>
  </div>
  <div style="margin-top:20px;">
    <button id="btn-prev" disabled>Previous</button>
    <button id="btn-next">Next</button>
  </div>
</main>

<script>
let allPages = [];
let currentPage = 0;

function getDisplayAddress(addr){ return addr.startsWith("wss://") ? addr : "wss://" + addr; }
function getApiAddress(addr){ return addr.replace("wss://",""); }

async function init(){
  try{
    const response = await fetch('./serverlistjson.txt');
    const rawText = await response.text();
    const pages = rawText.split(/}\s*{/).map((str,i,arr)=>{
      if(i===0) return str+"}";
      if(i===arr.length-1) return "{"+str;
      return "{"+str+"}";
    });
    pages.forEach(j => {
      try{
        const p = JSON.parse(j);
        if(p.success && Array.isArray(p.data)) allPages.push(p.data);
      }catch{}
    });
    renderPage(0);
    document.getElementById('btn-prev').addEventListener('click',()=>changePage(-1));
    document.getElementById('btn-next').addEventListener('click',()=>changePage(1));
    setInterval(refreshCurrentPageStatus, 20000);
  }catch(e){
    console.error("failed to load",e);
  }
}

function changePage(dir){
  const np = currentPage + dir;
  if(np>=0 && np<allPages.length){
    currentPage = np;
    renderPage(currentPage);
  }
}

function renderPage(idx){
  const cont = document.getElementById("dynamic-server-container");
  cont.innerHTML = "";
  const servers = allPages[idx] || [];
  servers.forEach(s => {
    const displayIP = getDisplayAddress(s.address);
    const apiIP = getApiAddress(s.address);

    const card = document.createElement("div");
    card.className="Server_card";
    card.dataset.apiAddress = apiIP;
    card.innerHTML=`
      <h2>
        ${s.name} <span class="status-dot" style="background:#444"></span>
      </h2>
      <div>Votes: <span style="color:#46e393">${s.votes}</span></div>
      <div>Tags: ${s.tags.join(", ")}</div>
      <div>IP: <span style="color:#fb8464">${displayIP}</span></div>
      <div class="status-meta" style="margin-top:8px;color:#aaa">Loading status...</div>
    `;
    cont.appendChild(card);
  });
  updateButtons();
  refreshCurrentPageStatus();
}

async function refreshCurrentPageStatus(){
  document.querySelectorAll(".Server_card").forEach(async card=>{
    const apiAddr = card.dataset.apiAddress;
    const dot = card.querySelector(".status-dot");
    const meta = card.querySelector(".status-meta");
    try{
      const res = await fetch(`https://topeaglerservers.com/api/status/${encodeURIComponent(apiAddr)}`);
      const json = await res.json();
      if(json.success && json.server && json.server.online){
        dot.style.background="#4caf50";
        meta.textContent=`Players: ${json.server.players.online} / ${json.server.players.max}`;
      }else{
        dot.style.background="#f44336";
        meta.textContent="Offline";
      }
    }catch{
      dot.style.background="#444";
      meta.textContent="Status Error";
    }
  });
}

function updateButtons(){
  document.getElementById("btn-prev").disabled = currentPage===0;
  document.getElementById("btn-next").disabled = currentPage===allPages.length-1;
}

document.addEventListener("DOMContentLoaded", init);
</script>

</body>
</html>
